#include "../include/bigint/BigInt.hpp"
#include "../include/bigint/Algorithms.hpp"
#include <cassert>
#include <iostream>
#include <string>
#include <chrono>

void test_basic_multiplication() {
    bigint::BigInt a("123");
    bigint::BigInt b("456");
    
    // bigint::BigInt c = a * b;
    bigint::BigInt c = bigint::algorithms::KaratsubaML(a, b);
    assert(c.toString() == "56088");
}

void test_multiplication_with_carry() {
    bigint::BigInt a("999999999");
    bigint::BigInt b("999999999");
    
    // bigint::BigInt c = a * b;
    bigint::BigInt c = bigint::algorithms::KaratsubaML(a, b);

    assert(c.toString() == "999999998000000001");
}

void test_negative_multiplication() {
    bigint::BigInt a("-123");
    bigint::BigInt b("100");

    // bigint::BigInt c = a * b;
    bigint::BigInt c = bigint::algorithms::KaratsubaML(a, b);
    assert(c.toString() == "-12300");
}

void test_multiplication_to_zero() {
    bigint::BigInt a("-100");
    bigint::BigInt b("0");

    // bigint::BigInt c = a * b;
    bigint::BigInt c = bigint::algorithms::KaratsubaML(a, b);

    assert(c.toString() == "0");
}

void test_large1() {
    std::string a = "1" + std::string(1000, '0');
    std::string b = "1" + std::string(2000, '0');

    bigint::BigInt num1(a);
    bigint::BigInt num2(b);

    bigint::BigInt res = bigint::algorithms::KaratsubaML(num1, num2);

    std::string c = "1" + std::string(3000, '0');
    assert(res.toString() == c);
}

void test_large2() {
    std::string a = std::string(1000, '9');
    std::string b = std::string(2000, '5');

    bigint::BigInt num1(a);
    bigint::BigInt num2(b);

    bigint::BigInt res = bigint::algorithms::KaratsubaML(num1, num2);

    std::string c = "555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555499999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444445";
    assert(res.toString() == c);
}

void test_compare() {
    std::string a = std::string(50000, '9');
    std::string b = std::string(70000, '5');

    bigint::BigInt num1(a);
    bigint::BigInt num2(b);

    auto startK = std::chrono::high_resolution_clock::now();
    bigint::BigInt resK = bigint::algorithms::KaratsubaML(num1, num2);
    auto endK = std::chrono::high_resolution_clock::now();
    auto diffK = std::chrono::duration_cast<std::chrono::microseconds>(endK - startK).count();
    
    auto start = std::chrono::high_resolution_clock::now();
    bigint::BigInt res = num1 * num2;
    auto end = std::chrono::high_resolution_clock::now();
    auto diff = std::chrono::duration_cast<std::chrono::microseconds>(end - start).count();

    std::cout << "Karatsuba: " << diffK << " us\n";
    std::cout << "Normal: " << diff << " us\n";

    assert(resK == res);
}

int main() {
    test_basic_multiplication();
    test_multiplication_with_carry();
    test_negative_multiplication();
    test_multiplication_to_zero();
    test_large1();
    test_large2();

    test_compare();

    std::cout << "Karatsuba Multiplication tests passed.\n";
    return 0;
}
